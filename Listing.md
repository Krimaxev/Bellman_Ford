# Листинг кода алгоритма
<pre style="font-family:monospace;color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); font-weight: 400; "><ol style="padding-left: 3em;"><li><span style="color: rgb(0, 0, 255); font-weight: 400;">import</span> tkinter <span style="color: rgb(0, 0, 255); font-weight: 400;">as</span> tk</li><li><span style="color: rgb(0, 0, 255); font-weight: 400;">from</span> tkinter <span style="color: rgb(0, 0, 255); font-weight: 400;">import</span> messagebox</li><li><span style="color: rgb(0, 0, 255); font-weight: 400;">import</span> math</li><li><span style="color: rgb(0, 0, 255); font-weight: 400;">import</span> re</li><li></li><li><span style="color: rgb(0, 0, 255); font-weight: 400;">class</span> <span style="color: rgb(163, 21, 21); font-weight: 400;">Graph</span>:</li><li>    <span style="color: rgb(163, 21, 21); font-weight: 400;">"""</span></li><li>    Класс для представления направленного взвешенного графа и реализации алгоритма Форда-Беллмана.</li><li>    """</li><li>    <span style="color: rgb(0, 0, 255); font-weight: 400;">def</span> <span style="color: rgb(163, 21, 21); font-weight: 400;">__init__</span>(<span style="color: rgb(0, 0, 0); font-weight: 400;">self, vertices</span>):</li><li>        <span style="color: rgb(163, 21, 21); font-weight: 400;">"""</span></li><li>        Инициализирует граф с заданным количеством вершин.</li><li></li><li>        :param vertices: Общее количество вершин в графе.</li><li>        """</li><li>        self.M = vertices   <span style="color: rgb(0, 128, 0); font-weight: 400;"># Общее количество вершин в графе</span></li><li>        self.graph = []     <span style="color: rgb(0, 128, 0); font-weight: 400;"># Список рёбер</span></li><li>        self.vertex_names = []  <span style="color: rgb(0, 128, 0); font-weight: 400;"># Список названий вершин</span></li><li></li><li>    <span style="color: rgb(0, 0, 255); font-weight: 400;">def</span> <span style="color: rgb(163, 21, 21); font-weight: 400;">add_edge</span>(<span style="color: rgb(0, 0, 0); font-weight: 400;">self, a, b, c</span>):</li><li>        <span style="color: rgb(163, 21, 21); font-weight: 400;">"""</span></li><li>        Добавляет ребро в граф.</li><li></li><li>        :param a: Индекс исходной вершины.</li><li>        :param b: Индекс конечной вершины.</li><li>        :param c: Вес ребра.</li><li>        """</li><li>        self.graph.append([a, b, c])</li><li></li><li>    <span style="color: rgb(0, 0, 255); font-weight: 400;">def</span> <span style="color: rgb(163, 21, 21); font-weight: 400;">print_solution</span>(<span style="color: rgb(0, 0, 0); font-weight: 400;">self, distance, predecessor, vertex_names</span>):</li><li>        <span style="color: rgb(163, 21, 21); font-weight: 400;">"""</span></li><li>        Форматирует и возвращает строку с результатами кратчайших путей.</li><li></li><li>        :param distance: Список расстояний до каждой вершины.</li><li>        :param predecessor: Список предшественников для каждой вершины.</li><li>        :param vertex_names: Список названий вершин.</li><li>        :return: Строка с таблицей кратчайших путей.</li><li>        """</li><li>        result = <span style="color: rgb(163, 21, 21); font-weight: 400;">"Вершина\tРасстояние\tПуть от Источника\n"</span></li><li>        <span style="color: rgb(0, 0, 255); font-weight: 400;">for</span> k <span style="color: rgb(0, 0, 255); font-weight: 400;">in</span> <span style="color: rgb(0, 0, 255); font-weight: 400;">range</span>(self.M):</li><li>            path = self.get_path(k, predecessor, vertex_names)</li><li>            distance_str = <span style="color: rgb(163, 21, 21); font-weight: 400;">"бесконечность"</span> <span style="color: rgb(0, 0, 255); font-weight: 400;">if</span> distance[k] == <span style="color: rgb(0, 0, 255); font-weight: 400;">float</span>(<span style="color: rgb(163, 21, 21); font-weight: 400;">"Inf"</span>) <span style="color: rgb(0, 0, 255); font-weight: 400;">else</span> <span style="color: rgb(0, 0, 255); font-weight: 400;">str</span>(distance[k])</li><li>            result += <span style="color: rgb(163, 21, 21); font-weight: 400;">f"<span style="color: rgb(163, 21, 21); font-weight: 400;">{vertex_names[k]}</span>\t\t<span style="color: rgb(163, 21, 21); font-weight: 400;">{distance_str}</span>\t\t<span style="color: rgb(163, 21, 21); font-weight: 400;">{path}</span>\n"</span></li><li>        <span style="color: rgb(0, 0, 255); font-weight: 400;">return</span> result</li><li></li><li>    <span style="color: rgb(0, 0, 255); font-weight: 400;">def</span> <span style="color: rgb(163, 21, 21); font-weight: 400;">get_path</span>(<span style="color: rgb(0, 0, 0); font-weight: 400;">self, vertex, predecessor, vertex_names</span>):</li><li>        <span style="color: rgb(163, 21, 21); font-weight: 400;">"""</span></li><li>        Восстанавливает путь от источника до заданной вершины.</li><li></li><li>        :param vertex: Индекс целевой вершины.</li><li>        :param predecessor: Список предшественников для каждой вершины.</li><li>        :param vertex_names: Список названий вершин.</li><li>        :return: Строка с последовательностью вершин в пути.</li><li>        """</li><li>        path = []</li><li>        <span style="color: rgb(0, 0, 255); font-weight: 400;">while</span> vertex <span style="color: rgb(0, 0, 255); font-weight: 400;">is</span> <span style="color: rgb(0, 0, 255); font-weight: 400;">not</span> <span style="color: rgb(163, 21, 21); font-weight: 400;">None</span>:</li><li>            path.insert(<span style="color: rgb(0, 0, 0); font-weight: 400;">0</span>, vertex_names[vertex])</li><li>            vertex = predecessor[vertex]</li><li>        <span style="color: rgb(0, 0, 255); font-weight: 400;">return</span> <span style="color: rgb(163, 21, 21); font-weight: 400;">" -&gt; "</span>.join(path)</li><li></li><li>    <span style="color: rgb(0, 0, 255); font-weight: 400;">def</span> <span style="color: rgb(163, 21, 21); font-weight: 400;">bellman_ford</span>(<span style="color: rgb(0, 0, 0); font-weight: 400;">self, src</span>):</li><li>        <span style="color: rgb(163, 21, 21); font-weight: 400;">"""</span></li><li>        Реализует алгоритм Форда-Беллмана для нахождения кратчайших путей от источника до всех вершин.</li><li></li><li>        :param src: Индекс исходной вершины.</li><li>        :return: Кортеж, содержащий статус выполнения и результат.</li><li>                 Если нет отрицательных циклов, возвращает (True, строки с результатами).</li><li>                 Если обнаружен отрицательный цикл, возвращает (False, сообщение об ошибке).</li><li>        """</li><li>        distance = [<span style="color: rgb(0, 0, 255); font-weight: 400;">float</span>(<span style="color: rgb(163, 21, 21); font-weight: 400;">"Inf"</span>)] * self.M</li><li>        predecessor = [<span style="color: rgb(163, 21, 21); font-weight: 400;">None</span>] * self.M</li><li>        distance[src] = <span style="color: rgb(0, 0, 0); font-weight: 400;">0</span></li><li></li><li>        <span style="color: rgb(0, 128, 0); font-weight: 400;"># Обновление расстояний</span></li><li>        <span style="color: rgb(0, 0, 255); font-weight: 400;">for</span> _ <span style="color: rgb(0, 0, 255); font-weight: 400;">in</span> <span style="color: rgb(0, 0, 255); font-weight: 400;">range</span>(self.M - <span style="color: rgb(0, 0, 0); font-weight: 400;">1</span>):</li><li>            <span style="color: rgb(0, 0, 255); font-weight: 400;">for</span> a, b, c <span style="color: rgb(0, 0, 255); font-weight: 400;">in</span> self.graph:</li><li>                <span style="color: rgb(0, 0, 255); font-weight: 400;">if</span> distance[a] != <span style="color: rgb(0, 0, 255); font-weight: 400;">float</span>(<span style="color: rgb(163, 21, 21); font-weight: 400;">"Inf"</span>) <span style="color: rgb(0, 0, 255); font-weight: 400;">and</span> distance[a] + c &lt; distance[b]:</li><li>                    distance[b] = distance[a] + c</li><li>                    predecessor[b] = a</li><li></li><li>        <span style="color: rgb(0, 128, 0); font-weight: 400;"># Проверка на наличие цикла отрицательного веса</span></li><li>        <span style="color: rgb(0, 0, 255); font-weight: 400;">for</span> a, b, c <span style="color: rgb(0, 0, 255); font-weight: 400;">in</span> self.graph:</li><li>            <span style="color: rgb(0, 0, 255); font-weight: 400;">if</span> distance[a] != <span style="color: rgb(0, 0, 255); font-weight: 400;">float</span>(<span style="color: rgb(163, 21, 21); font-weight: 400;">"Inf"</span>) <span style="color: rgb(0, 0, 255); font-weight: 400;">and</span> distance[a] + c &lt; distance[b]:</li><li>                <span style="color: rgb(0, 0, 255); font-weight: 400;">return</span> (<span style="color: rgb(163, 21, 21); font-weight: 400;">False</span>, <span style="color: rgb(163, 21, 21); font-weight: 400;">"Граф содержит цикл отрицательного веса."</span>)</li><li></li><li>        <span style="color: rgb(0, 0, 255); font-weight: 400;">return</span> (<span style="color: rgb(163, 21, 21); font-weight: 400;">True</span>, self.print_solution(distance, predecessor, vertex_names=self.vertex_names))</li><li></li><li></li><li><span style="color: rgb(0, 0, 255); font-weight: 400;">class</span> <span style="color: rgb(163, 21, 21); font-weight: 400;">BellmanFordGUI</span>:</li><li>    <span style="color: rgb(163, 21, 21); font-weight: 400;">"""</span></li><li>    Класс для создания графического интерфейса пользователя и взаимодействия с графом.</li><li>    """</li><li>    <span style="color: rgb(0, 0, 255); font-weight: 400;">def</span> <span style="color: rgb(163, 21, 21); font-weight: 400;">__init__</span>(<span style="color: rgb(0, 0, 0); font-weight: 400;">self</span>):</li><li>        <span style="color: rgb(163, 21, 21); font-weight: 400;">"""</span></li><li>        Инициализирует главное окно приложения и создаёт основной интерфейс.</li><li>        """</li><li>        self.root = tk.Tk()</li><li>        self.root.title(<span style="color: rgb(163, 21, 21); font-weight: 400;">"Алгоритм Форда-Беллмана"</span>)</li><li>        self.root.geometry(<span style="color: rgb(163, 21, 21); font-weight: 400;">"800x600"</span>)</li><li>        self.create_main_window()</li><li></li><li>    <span style="color: rgb(0, 0, 255); font-weight: 400;">def</span> <span style="color: rgb(163, 21, 21); font-weight: 400;">create_main_window</span>(<span style="color: rgb(0, 0, 0); font-weight: 400;">self</span>):</li><li>        <span style="color: rgb(163, 21, 21); font-weight: 400;">"""</span></li><li>        Создаёт главное окно с вводом количества вершин и их названий.</li><li>        """</li><li>        <span style="color: rgb(0, 128, 0); font-weight: 400;"># Инструкция</span></li><li>        instruction = tk.Label(</li><li>            self.root,</li><li>            text=<span style="color: rgb(163, 21, 21); font-weight: 400;">"Инструкция:\n'-' заменяется на 0\n'б' заменяется на бесконечность (999)\n"</span></li><li>                 <span style="color: rgb(163, 21, 21); font-weight: 400;">"Введите рёбра графа в формате: Вершина1 -&gt; Вершина2 вес"</span>,</li><li>            justify=tk.LEFT,</li><li>            font=(<span style="color: rgb(163, 21, 21); font-weight: 400;">'Arial'</span>, <span style="color: rgb(0, 0, 0); font-weight: 400;">12</span>)</li><li>        )</li><li>        instruction.pack(pady=<span style="color: rgb(0, 0, 0); font-weight: 400;">10</span>)</li><li></li><li>        <span style="color: rgb(0, 128, 0); font-weight: 400;"># Ввод количества вершин</span></li><li>        vertices_frame = tk.Frame(self.root)</li><li>        vertices_frame.pack(pady=<span style="color: rgb(0, 0, 0); font-weight: 400;">5</span>)</li><li>        tk.Label(vertices_frame, text=<span style="color: rgb(163, 21, 21); font-weight: 400;">"Количество вершин:"</span>, font=(<span style="color: rgb(163, 21, 21); font-weight: 400;">'Arial'</span>, <span style="color: rgb(0, 0, 0); font-weight: 400;">12</span>)).pack(side=tk.LEFT, padx=<span style="color: rgb(0, 0, 0); font-weight: 400;">5</span>)</li><li>        self.vertices_entry = tk.Entry(vertices_frame, width=<span style="color: rgb(0, 0, 0); font-weight: 400;">10</span>, font=(<span style="color: rgb(163, 21, 21); font-weight: 400;">'Arial'</span>, <span style="color: rgb(0, 0, 0); font-weight: 400;">12</span>))</li><li>        self.vertices_entry.pack(side=tk.LEFT, padx=<span style="color: rgb(0, 0, 0); font-weight: 400;">5</span>)</li><li></li><li>        <span style="color: rgb(0, 128, 0); font-weight: 400;"># Ввод названий вершин</span></li><li>        names_frame = tk.Frame(self.root)</li><li>        names_frame.pack(pady=<span style="color: rgb(0, 0, 0); font-weight: 400;">5</span>)</li><li>        tk.Label(names_frame, text=<span style="color: rgb(163, 21, 21); font-weight: 400;">"Названия вершин (через запятую):"</span>, font=(<span style="color: rgb(163, 21, 21); font-weight: 400;">'Arial'</span>, <span style="color: rgb(0, 0, 0); font-weight: 400;">12</span>)).pack(side=tk.LEFT, padx=<span style="color: rgb(0, 0, 0); font-weight: 400;">5</span>)</li><li>        self.names_entry = tk.Entry(names_frame, width=<span style="color: rgb(0, 0, 0); font-weight: 400;">50</span>, font=(<span style="color: rgb(163, 21, 21); font-weight: 400;">'Arial'</span>, <span style="color: rgb(0, 0, 0); font-weight: 400;">12</span>))</li><li>        self.names_entry.pack(side=tk.LEFT, padx=<span style="color: rgb(0, 0, 0); font-weight: 400;">5</span>)</li><li></li><li>        <span style="color: rgb(0, 128, 0); font-weight: 400;"># Кнопка "Продолжить"</span></li><li>        tk.Button(</li><li>            self.root,</li><li>            text=<span style="color: rgb(163, 21, 21); font-weight: 400;">"Продолжить"</span>,</li><li>            command=self.show_edge_input_page,</li><li>            font=(<span style="color: rgb(163, 21, 21); font-weight: 400;">'Arial'</span>, <span style="color: rgb(0, 0, 0); font-weight: 400;">12</span>, <span style="color: rgb(163, 21, 21); font-weight: 400;">'bold'</span>)</li><li>        ).pack(pady=<span style="color: rgb(0, 0, 0); font-weight: 400;">20</span>)</li><li></li><li>    <span style="color: rgb(0, 0, 255); font-weight: 400;">def</span> <span style="color: rgb(163, 21, 21); font-weight: 400;">show_edge_input_page</span>(<span style="color: rgb(0, 0, 0); font-weight: 400;">self</span>):</li><li>        <span style="color: rgb(163, 21, 21); font-weight: 400;">"""</span></li><li>        Обрабатывает ввод количества вершин и их названий, переходя к вводу рёбер.</li><li>        """</li><li>        <span style="color: rgb(0, 0, 255); font-weight: 400;">try</span>:</li><li>            self.vertex_count = <span style="color: rgb(0, 0, 255); font-weight: 400;">int</span>(self.vertices_entry.get())</li><li>            self.vertex_names = [name.strip() <span style="color: rgb(0, 0, 255); font-weight: 400;">for</span> name <span style="color: rgb(0, 0, 255); font-weight: 400;">in</span> self.names_entry.get().split(<span style="color: rgb(163, 21, 21); font-weight: 400;">','</span>)]</li><li>            <span style="color: rgb(0, 0, 255); font-weight: 400;">if</span> <span style="color: rgb(0, 0, 255); font-weight: 400;">len</span>(self.vertex_names) != self.vertex_count:</li><li>                <span style="color: rgb(0, 0, 255); font-weight: 400;">raise</span> ValueError(<span style="color: rgb(163, 21, 21); font-weight: 400;">"Количество имён не совпадает с количеством вершин."</span>)</li><li>            <span style="color: rgb(0, 0, 255); font-weight: 400;">if</span> self.vertex_count &lt;= <span style="color: rgb(0, 0, 0); font-weight: 400;">0</span>:</li><li>                <span style="color: rgb(0, 0, 255); font-weight: 400;">raise</span> ValueError(<span style="color: rgb(163, 21, 21); font-weight: 400;">"Количество вершин должно быть положительным числом."</span>)</li><li>        <span style="color: rgb(0, 0, 255); font-weight: 400;">except</span> ValueError <span style="color: rgb(0, 0, 255); font-weight: 400;">as</span> e:</li><li>            messagebox.showerror(<span style="color: rgb(163, 21, 21); font-weight: 400;">"Ошибка"</span>, <span style="color: rgb(0, 0, 255); font-weight: 400;">str</span>(e))</li><li>            <span style="color: rgb(0, 0, 255); font-weight: 400;">return</span></li><li></li><li>        <span style="color: rgb(0, 128, 0); font-weight: 400;"># Создание экземпляра Graph</span></li><li>        self.graph_instance = Graph(self.vertex_count)</li><li>        self.graph_instance.vertex_names = self.vertex_names  <span style="color: rgb(0, 128, 0); font-weight: 400;"># Передаём названия вершин в класс Graph</span></li><li></li><li>        <span style="color: rgb(0, 128, 0); font-weight: 400;"># Уничтожаем главное окно и создаём окно ввода рёбер</span></li><li>        <span style="color: rgb(0, 0, 255); font-weight: 400;">for</span> widget <span style="color: rgb(0, 0, 255); font-weight: 400;">in</span> self.root.winfo_children():</li><li>            widget.destroy()</li><li></li><li>        self.create_edge_input_page()</li><li></li><li>    <span style="color: rgb(0, 0, 255); font-weight: 400;">def</span> <span style="color: rgb(163, 21, 21); font-weight: 400;">create_edge_input_page</span>(<span style="color: rgb(0, 0, 0); font-weight: 400;">self</span>):</li><li>        <span style="color: rgb(163, 21, 21); font-weight: 400;">"""</span></li><li>        Создаёт окно для ввода рёбер графа пользователем.</li><li>        """</li><li>        <span style="color: rgb(0, 128, 0); font-weight: 400;"># Инструкция</span></li><li>        instruction = tk.Label(</li><li>            self.root,</li><li>            text=<span style="color: rgb(163, 21, 21); font-weight: 400;">"Введите рёбра графа в формате:\n"</span></li><li>                 <span style="color: rgb(163, 21, 21); font-weight: 400;">"Вершина1 -&gt; Вершина2 вес\n"</span></li><li>                 <span style="color: rgb(163, 21, 21); font-weight: 400;">"Каждое ребро на новой строке.\n"</span></li><li>                 <span style="color: rgb(163, 21, 21); font-weight: 400;">"Для завершения ввода нажмите \"Рассчитать\"."</span>,</li><li>            justify=tk.LEFT,</li><li>            font=(<span style="color: rgb(163, 21, 21); font-weight: 400;">'Arial'</span>, <span style="color: rgb(0, 0, 0); font-weight: 400;">12</span>)</li><li>        )</li><li>        instruction.pack(pady=<span style="color: rgb(0, 0, 0); font-weight: 400;">10</span>)</li><li></li><li>        <span style="color: rgb(0, 128, 0); font-weight: 400;"># Текстовое поле для ввода рёбер</span></li><li>        self.edges_text = tk.Text(self.root, width=<span style="color: rgb(0, 0, 0); font-weight: 400;">100</span>, height=<span style="color: rgb(0, 0, 0); font-weight: 400;">20</span>, font=(<span style="color: rgb(163, 21, 21); font-weight: 400;">'Arial'</span>, <span style="color: rgb(0, 0, 0); font-weight: 400;">12</span>))</li><li>        self.edges_text.pack(pady=<span style="color: rgb(0, 0, 0); font-weight: 400;">10</span>)</li><li></li><li>        <span style="color: rgb(0, 128, 0); font-weight: 400;"># Кнопка расчёта</span></li><li>        tk.Button(</li><li>            self.root,</li><li>            text=<span style="color: rgb(163, 21, 21); font-weight: 400;">"Рассчитать"</span>,</li><li>            command=self.process_edges,</li><li>            font=(<span style="color: rgb(163, 21, 21); font-weight: 400;">'Arial'</span>, <span style="color: rgb(0, 0, 0); font-weight: 400;">12</span>, <span style="color: rgb(163, 21, 21); font-weight: 400;">'bold'</span>)</li><li>        ).pack(pady=<span style="color: rgb(0, 0, 0); font-weight: 400;">10</span>)</li><li></li><li>    <span style="color: rgb(0, 0, 255); font-weight: 400;">def</span> <span style="color: rgb(163, 21, 21); font-weight: 400;">process_edges</span>(<span style="color: rgb(0, 0, 0); font-weight: 400;">self</span>):</li><li>        <span style="color: rgb(163, 21, 21); font-weight: 400;">"""</span></li><li>        Обрабатывает введённые пользователем рёбра, добавляя их в граф и запускает алгоритм Форда-Беллмана.</li><li>        """</li><li>        raw_input = self.edges_text.get(<span style="color: rgb(163, 21, 21); font-weight: 400;">"1.0"</span>, tk.END).strip()</li><li>        <span style="color: rgb(0, 0, 255); font-weight: 400;">if</span> <span style="color: rgb(0, 0, 255); font-weight: 400;">not</span> raw_input:</li><li>            messagebox.showerror(<span style="color: rgb(163, 21, 21); font-weight: 400;">"Ошибка"</span>, <span style="color: rgb(163, 21, 21); font-weight: 400;">"Пожалуйста, введите хотя бы одно ребро."</span>)</li><li>            <span style="color: rgb(0, 0, 255); font-weight: 400;">return</span></li><li></li><li>        lines = raw_input.split(<span style="color: rgb(163, 21, 21); font-weight: 400;">'\n'</span>)</li><li>        <span style="color: rgb(0, 128, 0); font-weight: 400;"># Обновлённый паттерн: допускает произвольное количество пробелов вокруг '-&gt;' и после 'вес'</span></li><li>        edge_pattern = re.<span style="color: rgb(0, 0, 255); font-weight: 400;">compile</span>(<span style="color: rgb(163, 21, 21); font-weight: 400;">r'^(\w+)\s*-&gt;\s*(\w+)\s+вес\s+([-+]?\d+)$'</span>)</li><li></li><li>        <span style="color: rgb(0, 0, 255); font-weight: 400;">for</span> line_num, line <span style="color: rgb(0, 0, 255); font-weight: 400;">in</span> <span style="color: rgb(0, 0, 255); font-weight: 400;">enumerate</span>(lines, start=<span style="color: rgb(0, 0, 0); font-weight: 400;">1</span>):</li><li>            <span style="color: rgb(0, 128, 0); font-weight: 400;"># Удаляем лишние пробелы внутри строки</span></li><li>            normalized_line = <span style="color: rgb(163, 21, 21); font-weight: 400;">' '</span>.join(line.strip().split())</li><li></li><li>            <span style="color: rgb(0, 128, 0); font-weight: 400;"># Пропускаем пустые строки</span></li><li>            <span style="color: rgb(0, 0, 255); font-weight: 400;">if</span> <span style="color: rgb(0, 0, 255); font-weight: 400;">not</span> normalized_line:</li><li>                <span style="color: rgb(0, 0, 255); font-weight: 400;">continue</span></li><li></li><li>            <span style="color: rgb(0, 0, 255); font-weight: 400;">match</span> = edge_pattern.<span style="color: rgb(0, 0, 255); font-weight: 400;">match</span>(normalized_line)</li><li>            <span style="color: rgb(0, 0, 255); font-weight: 400;">if</span> <span style="color: rgb(0, 0, 255); font-weight: 400;">match</span>:</li><li>                a, b, c = <span style="color: rgb(0, 0, 255); font-weight: 400;">match</span>.groups()</li><li>                <span style="color: rgb(0, 0, 255); font-weight: 400;">if</span> a <span style="color: rgb(0, 0, 255); font-weight: 400;">not</span> <span style="color: rgb(0, 0, 255); font-weight: 400;">in</span> self.graph_instance.vertex_names <span style="color: rgb(0, 0, 255); font-weight: 400;">or</span> b <span style="color: rgb(0, 0, 255); font-weight: 400;">not</span> <span style="color: rgb(0, 0, 255); font-weight: 400;">in</span> self.graph_instance.vertex_names:</li><li>                    messagebox.showerror(<span style="color: rgb(163, 21, 21); font-weight: 400;">"Ошибка"</span>,</li><li>                                         <span style="color: rgb(163, 21, 21); font-weight: 400;">f"В строке <span style="color: rgb(163, 21, 21); font-weight: 400;">{line_num}</span>: Вершины должны существовать в списке названий."</span>)</li><li>                    <span style="color: rgb(0, 0, 255); font-weight: 400;">return</span></li><li>                a_index = self.graph_instance.vertex_names.index(a)</li><li>                b_index = self.graph_instance.vertex_names.index(b)</li><li></li><li>                <span style="color: rgb(0, 128, 0); font-weight: 400;"># Обработка специальных символов</span></li><li>                <span style="color: rgb(0, 0, 255); font-weight: 400;">if</span> c == <span style="color: rgb(163, 21, 21); font-weight: 400;">'-'</span>:</li><li>                    c = <span style="color: rgb(0, 0, 0); font-weight: 400;">0</span></li><li>                <span style="color: rgb(0, 0, 255); font-weight: 400;">elif</span> c.lower() == <span style="color: rgb(163, 21, 21); font-weight: 400;">'б'</span>:</li><li>                    c = <span style="color: rgb(0, 0, 0); font-weight: 400;">999</span></li><li>                <span style="color: rgb(0, 0, 255); font-weight: 400;">else</span>:</li><li>                    <span style="color: rgb(0, 0, 255); font-weight: 400;">try</span>:</li><li>                        c = <span style="color: rgb(0, 0, 255); font-weight: 400;">int</span>(c)</li><li>                    <span style="color: rgb(0, 0, 255); font-weight: 400;">except</span> ValueError:</li><li>                        messagebox.showerror(<span style="color: rgb(163, 21, 21); font-weight: 400;">"Ошибка"</span>, <span style="color: rgb(163, 21, 21); font-weight: 400;">f"В строке <span style="color: rgb(163, 21, 21); font-weight: 400;">{line_num}</span>: Некорректный вес '<span style="color: rgb(163, 21, 21); font-weight: 400;">{c}</span>'."</span>)</li><li>                        <span style="color: rgb(0, 0, 255); font-weight: 400;">return</span></li><li></li><li>                self.graph_instance.add_edge(a_index, b_index, c)</li><li>            <span style="color: rgb(0, 0, 255); font-weight: 400;">else</span>:</li><li>                <span style="color: rgb(0, 128, 0); font-weight: 400;"># Если строка не соответствует паттерну, проверяем, является ли она пустой после нормализации</span></li><li>                <span style="color: rgb(0, 0, 255); font-weight: 400;">if</span> normalized_line:</li><li>                    messagebox.showerror(<span style="color: rgb(163, 21, 21); font-weight: 400;">"Ошибка"</span>, <span style="color: rgb(163, 21, 21); font-weight: 400;">f"В строке <span style="color: rgb(163, 21, 21); font-weight: 400;">{line_num}</span>: Некорректный формат."</span>)</li><li>                    <span style="color: rgb(0, 0, 255); font-weight: 400;">return</span></li><li>                <span style="color: rgb(0, 128, 0); font-weight: 400;"># Если строка пустая, просто продолжаем</span></li><li>                <span style="color: rgb(0, 0, 255); font-weight: 400;">continue</span></li><li></li><li>        <span style="color: rgb(0, 128, 0); font-weight: 400;"># После успешного ввода всех рёбер запускаем алгоритм</span></li><li>        self.calculate_bellman_ford()</li><li></li><li>    <span style="color: rgb(0, 0, 255); font-weight: 400;">def</span> <span style="color: rgb(163, 21, 21); font-weight: 400;">calculate_bellman_ford</span>(<span style="color: rgb(0, 0, 0); font-weight: 400;">self</span>):</li><li>        <span style="color: rgb(163, 21, 21); font-weight: 400;">"""</span></li><li>        Запускает алгоритм Форда-Беллмана и отображает результаты в новом окне.</li><li>        """</li><li>        status, result = self.graph_instance.bellman_ford(<span style="color: rgb(0, 0, 0); font-weight: 400;">0</span>)  <span style="color: rgb(0, 128, 0); font-weight: 400;"># Источник - первая вершина</span></li><li></li><li>        <span style="color: rgb(0, 128, 0); font-weight: 400;"># Создание окна с результатами</span></li><li>        result_window = tk.Toplevel(self.root)</li><li>        result_window.title(<span style="color: rgb(163, 21, 21); font-weight: 400;">"Результаты Алгоритма Форда-Беллмана"</span>)</li><li></li><li>        canvas = tk.Canvas(result_window, width=<span style="color: rgb(0, 0, 0); font-weight: 400;">800</span>, height=<span style="color: rgb(0, 0, 0); font-weight: 400;">600</span>, bg=<span style="color: rgb(163, 21, 21); font-weight: 400;">'white'</span>)</li><li>        canvas.pack(pady=<span style="color: rgb(0, 0, 0); font-weight: 400;">10</span>)</li><li></li><li>        <span style="color: rgb(0, 128, 0); font-weight: 400;"># Размещение вершин по кругу</span></li><li>        radius = <span style="color: rgb(0, 0, 0); font-weight: 400;">250</span></li><li>        center_x = <span style="color: rgb(0, 0, 0); font-weight: 400;">400</span></li><li>        center_y = <span style="color: rgb(0, 0, 0); font-weight: 400;">300</span></li><li>        vertex_positions = []</li><li></li><li>        <span style="color: rgb(0, 0, 255); font-weight: 400;">for</span> i <span style="color: rgb(0, 0, 255); font-weight: 400;">in</span> <span style="color: rgb(0, 0, 255); font-weight: 400;">range</span>(self.graph_instance.M):</li><li>            angle = <span style="color: rgb(0, 0, 0); font-weight: 400;">2</span> * math.pi * i / self.graph_instance.M</li><li>            x = center_x + radius * math.cos(angle)</li><li>            y = center_y + radius * math.sin(angle)</li><li>            vertex_positions.append((x, y))</li><li></li><li>            <span style="color: rgb(0, 128, 0); font-weight: 400;"># Рисуем вершину</span></li><li>            canvas.create_oval(x - <span style="color: rgb(0, 0, 0); font-weight: 400;">25</span>, y - <span style="color: rgb(0, 0, 0); font-weight: 400;">25</span>, x + <span style="color: rgb(0, 0, 0); font-weight: 400;">25</span>, y + <span style="color: rgb(0, 0, 0); font-weight: 400;">25</span>, fill=<span style="color: rgb(163, 21, 21); font-weight: 400;">'lightblue'</span>, width=<span style="color: rgb(0, 0, 0); font-weight: 400;">2</span>)</li><li>            canvas.create_text(x, y, text=self.graph_instance.vertex_names[i], font=(<span style="color: rgb(163, 21, 21); font-weight: 400;">'Arial'</span>, <span style="color: rgb(0, 0, 0); font-weight: 400;">14</span>, <span style="color: rgb(163, 21, 21); font-weight: 400;">'bold'</span>))</li><li></li><li>        <span style="color: rgb(0, 128, 0); font-weight: 400;"># Рисуем рёбра</span></li><li>        <span style="color: rgb(0, 0, 255); font-weight: 400;">for</span> edge <span style="color: rgb(0, 0, 255); font-weight: 400;">in</span> self.graph_instance.graph:</li><li>            a, b, c = edge</li><li>            x1, y1 = vertex_positions[a]</li><li>            x2, y2 = vertex_positions[b]</li><li></li><li>            <span style="color: rgb(0, 128, 0); font-weight: 400;"># Вычисляем направляющий вектор</span></li><li>            dx = x2 - x1</li><li>            dy = y2 - y1</li><li>            length = math.sqrt(dx * dx + dy * dy)</li><li></li><li>            <span style="color: rgb(0, 0, 255); font-weight: 400;">if</span> length != <span style="color: rgb(0, 0, 0); font-weight: 400;">0</span>:</li><li>                <span style="color: rgb(0, 128, 0); font-weight: 400;"># Нормализуем вектор</span></li><li>                dx /= length</li><li>                dy /= length</li><li></li><li>                <span style="color: rgb(0, 128, 0); font-weight: 400;"># Сдвигаем начальную и конечную точки</span></li><li>                start_x = x1 + dx * <span style="color: rgb(0, 0, 0); font-weight: 400;">25</span></li><li>                start_y = y1 + dy * <span style="color: rgb(0, 0, 0); font-weight: 400;">25</span></li><li>                end_x = x2 - dx * <span style="color: rgb(0, 0, 0); font-weight: 400;">25</span></li><li>                end_y = y2 - dy * <span style="color: rgb(0, 0, 0); font-weight: 400;">25</span></li><li></li><li>                <span style="color: rgb(0, 128, 0); font-weight: 400;"># Рисуем стрелку</span></li><li>                canvas.create_line(start_x, start_y, end_x, end_y,</li><li>                                   arrow=tk.LAST, width=<span style="color: rgb(0, 0, 0); font-weight: 400;">2</span>, fill=<span style="color: rgb(163, 21, 21); font-weight: 400;">'black'</span>,</li><li>                                   arrowshape=(<span style="color: rgb(0, 0, 0); font-weight: 400;">16</span>, <span style="color: rgb(0, 0, 0); font-weight: 400;">20</span>, <span style="color: rgb(0, 0, 0); font-weight: 400;">8</span>))</li><li></li><li>                <span style="color: rgb(0, 128, 0); font-weight: 400;"># Смещение текста перпендикулярно ребру</span></li><li>                perp_dx = -dy</li><li>                perp_dy = dx</li><li>                offset = <span style="color: rgb(0, 0, 0); font-weight: 400;">20</span>  <span style="color: rgb(0, 128, 0); font-weight: 400;"># Размер смещения</span></li><li>                mx = (start_x + end_x) / <span style="color: rgb(0, 0, 0); font-weight: 400;">2</span> + perp_dx * offset</li><li>                my = (start_y + end_y) / <span style="color: rgb(0, 0, 0); font-weight: 400;">2</span> + perp_dy * offset</li><li></li><li>                canvas.create_text(mx, my, text=<span style="color: rgb(0, 0, 255); font-weight: 400;">str</span>(c),</li><li>                                   font=(<span style="color: rgb(163, 21, 21); font-weight: 400;">'Arial'</span>, <span style="color: rgb(0, 0, 0); font-weight: 400;">12</span>, <span style="color: rgb(163, 21, 21); font-weight: 400;">'bold'</span>), fill=<span style="color: rgb(163, 21, 21); font-weight: 400;">'red'</span>)</li><li></li><li>        <span style="color: rgb(0, 128, 0); font-weight: 400;"># Отображение результатов в текстовом формате</span></li><li>        <span style="color: rgb(0, 0, 255); font-weight: 400;">if</span> <span style="color: rgb(0, 0, 255); font-weight: 400;">not</span> status:</li><li>            <span style="color: rgb(0, 128, 0); font-weight: 400;"># Если обнаружен отрицательный цикл</span></li><li>            tk.Label(result_window, text=result, font=(<span style="color: rgb(163, 21, 21); font-weight: 400;">'Arial'</span>, <span style="color: rgb(0, 0, 0); font-weight: 400;">14</span>, <span style="color: rgb(163, 21, 21); font-weight: 400;">'bold'</span>), fg=<span style="color: rgb(163, 21, 21); font-weight: 400;">'red'</span>).pack(pady=<span style="color: rgb(0, 0, 0); font-weight: 400;">10</span>)</li><li>        <span style="color: rgb(0, 0, 255); font-weight: 400;">else</span>:</li><li>            <span style="color: rgb(0, 128, 0); font-weight: 400;"># Если цикла нет, отображаем расстояния и пути</span></li><li>            result_text = <span style="color: rgb(163, 21, 21); font-weight: 400;">"Кратчайшие расстояния и пути от источника:\n\n"</span></li><li>            <span style="color: rgb(0, 0, 255); font-weight: 400;">for</span> line <span style="color: rgb(0, 0, 255); font-weight: 400;">in</span> result.split(<span style="color: rgb(163, 21, 21); font-weight: 400;">'\n'</span>)[<span style="color: rgb(0, 0, 0); font-weight: 400;">1</span>:]:</li><li>                result_text += <span style="color: rgb(163, 21, 21); font-weight: 400;">f"<span style="color: rgb(163, 21, 21); font-weight: 400;">{line}</span>\n"</span></li><li></li><li>            <span style="color: rgb(0, 128, 0); font-weight: 400;"># Используем виджет Text для более структурированного отображения</span></li><li>            text_widget = tk.Text(result_window, width=<span style="color: rgb(0, 0, 0); font-weight: 400;">60</span>, height=<span style="color: rgb(0, 0, 0); font-weight: 400;">20</span>, font=(<span style="color: rgb(163, 21, 21); font-weight: 400;">'Arial'</span>, <span style="color: rgb(0, 0, 0); font-weight: 400;">12</span>))</li><li>            text_widget.pack(pady=<span style="color: rgb(0, 0, 0); font-weight: 400;">10</span>)</li><li>            text_widget.insert(tk.END, result)</li><li>            text_widget.config(state=<span style="color: rgb(163, 21, 21); font-weight: 400;">'disabled'</span>)  <span style="color: rgb(0, 128, 0); font-weight: 400;"># Сделать текст только для чтения</span></li><li></li><li><span style="color: rgb(0, 0, 255); font-weight: 400;">if</span> __name__ == <span style="color: rgb(163, 21, 21); font-weight: 400;">"__main__"</span>:</li><li>    app = BellmanFordGUI()</li><li>    app.root.mainloop()</li></ol></pre>
